# 📊 Isolation Forest 시각화 분석 완벽 가이드

생성된 파일: `isolation_forest_detailed_analysis.png`

---

## 🎯 전체 구성 (4개 그래프)

```
┌─────────────────────────────┬─────────────────────────────┐
│  1. Anomaly Score           │  2. Top 10 Important        │
│     Distribution            │     Features                │
│  (이상 점수 분포)            │  (중요 센서 순위)            │
├─────────────────────────────┼─────────────────────────────┤
│  3. Normal vs Anomaly       │  4. Top 3 Anomalies         │
│     Distribution            │     Feature Profile         │
│  (정상/이상 비율)            │  (상위 이상 데이터 패턴)     │
└─────────────────────────────┴─────────────────────────────┘
```

---

## 📈 1. Anomaly Score Distribution (왼쪽 위)

### 📊 그래프 설명
- **녹색 히스토그램**: 정상 데이터의 이상 점수 분포
- **빨간색 히스토그램**: 이상 데이터의 이상 점수 분포
- **X축**: Anomaly Score (이상 점수, -0.70 ~ -0.35)
- **Y축**: Frequency (빈도수)

### 🔍 해석

#### ✅ **정상 데이터 (녹색)**
```
분포 위치: -0.35 근처에 집중
형태: 오른쪽으로 치우친 종 모양
빈도: 약 7,000개 피크
```

**의미**:
- 대부분의 정상 데이터는 **-0.35 부근**의 높은 점수를 받음
- **점수가 높을수록** (0에 가까울수록) 정상

#### ❌ **이상 데이터 (빨간색)**
```
분포 위치: -0.70 ~ -0.55에 분산
형태: 넓게 퍼진 분포
빈도: 약 500개 피크
```

**의미**:
- 이상 데이터는 **-0.70 이하**의 낮은 점수를 받음
- **점수가 낮을수록** 더 이상함
- 가장 이상한 데이터는 -0.73 정도

### 💡 핵심 인사이트
```
✓ 정상과 이상이 명확히 분리됨 → 모델 성능 우수!
✓ 분리 지점: 약 -0.50 근처
✓ 이상 점수 < -0.50 → 이상으로 판단
```

---

## 🏆 2. Top 10 Important Features (오른쪽 위)

### 📊 그래프 설명
- **가로 막대 그래프**: 중요도가 높은 센서 10개
- **X축**: Average Z-Score (평균 Z-점수, 이상 기여도)
- **Y축**: 센서 이름
- **색상**: 빨간색 계열 (진할수록 중요)

### 🔍 해석

#### 🥇 **Top 4 (가장 중요) - 모두 Kurtosis(첨도)**
```
1. SH_LD_EBY_VIBRAT_kurtosis  : 4.10
2. VD_EBY_VIBRAT_kurtosis     : 4.10
3. HD_EBY_VIBRAT_kurtosis     : 4.10
4. SH_TD_EBY_VIBRAT_kurtosis  : 4.10
```

**의미**:
- **Kurtosis(첨도)**: 진동의 극단값이 얼마나 자주 발생하는지
- 높은 첨도 = 큰 충격/진동이 간헐적으로 발생
- **이상 탐지에 가장 결정적인 지표!**

#### 🥈 **Top 5-8 - Peak-to-Peak (P2P)**
```
5. VD_EBY_VIBRAT_p2p          : 3.31
6. SH_LD_EBY_VIBRAT_p2p       : 3.31
7. SH_TD_EBY_VIBRAT_p2p       : 3.31
8. HD_EBY_VIBRAT_p2p          : 3.31
```

**의미**:
- **Peak-to-Peak**: 진동의 최댓값과 최솟값 차이
- 높은 P2P = 진동 폭이 큼
- **진동의 진폭이 이상 탐지에 중요**

#### 🥉 **Top 9-10 - Skewness(왜도)**
```
9. HD_EBY_VIBRAT_skewness     : 2.90
10. SH_LD_EBY_VIBRAT_skewness : 2.90
```

**의미**:
- **Skewness(왜도)**: 진동 분포의 비대칭성
- 높은 왜도 = 한쪽으로 치우친 진동
- **비정상적인 진동 패턴 감지**

### 💡 핵심 인사이트
```
🎯 진동 센서의 통계적 특성이 핵심!
   1순위: 첨도 (극단값 발생 빈도)
   2순위: Peak-to-Peak (진폭)
   3순위: 왜도 (비대칭성)

🔧 실무 적용:
   → 진동의 "형태"가 절대값보다 중요
   → 간헐적 충격, 큰 진폭, 비대칭 패턴 = 이상 신호
```

### 📍 센서 위치 분석
```
SH_LD: 축 하중 방향 (Shaft Load Direction)
SH_TD: 축 접선 방향 (Shaft Tangential Direction)
VD:    수직 방향 (Vertical Direction)
HD:    수평 방향 (Horizontal Direction)
EBY:   엔진 베이 (Engine Bay)
```

**결론**: **모든 방향의 진동이 고르게 중요** → 전방위 모니터링 필요

---

## 📊 3. Normal vs Anomaly Distribution (왼쪽 아래)

### 📊 그래프 설명
- **파이 차트**: 정상 vs 이상 데이터 비율
- **녹색**: Normal (정상)
- **빨간색**: Anomaly (이상)

### 🔍 해석

```
정상: 95.0% (94,927개)
이상:  5.0% (4,974개)
```

### 💡 핵심 인사이트

#### ✅ **5% 이상률의 의미**
```
적절한 수준:
- 너무 낮으면 (1% 미만): 실제 이상을 놓칠 수 있음
- 너무 높으면 (10% 이상): 오탐이 많아 신뢰도 하락
- 5% 수준: 실무적으로 관리 가능한 수준
```

#### 🎯 **비즈니스 관점**
```
100척의 선박 운항 시:
- 약 5척에서 이상 신호 감지
- 정비팀이 집중적으로 점검
- 나머지 95척은 정상 운항

또는 1일 1,000개 데이터 수집 시:
- 약 50개에서 이상 감지
- 정비팀 알림 발송
- 우선순위별 점검
```

#### ⚖️ **Threshold 조정 가능성**
```
더 보수적으로 (이상 비율 ↑):
- 놓치는 이상 최소화
- 오탐 증가 (정비 비용 ↑)

더 공격적으로 (이상 비율 ↓):
- 오탐 최소화
- 놓치는 이상 증가 (고장 위험 ↑)

현재 5%: 균형잡힌 설정 ✓
```

---

## 📉 4. Top 3 Anomalies - Feature Contribution Profile (오른쪽 아래)

### 📊 그래프 설명
- **선 그래프**: 가장 이상한 3개 데이터의 특징 프로필
- **파란색**: Anomaly #1 (가장 이상)
- **주황색**: Anomaly #2
- **녹색**: Anomaly #3
- **X축**: Top 1~5 (각 이상 데이터의 상위 5개 문제 센서)
- **Y축**: Z-Score (이상도)

### 🔍 해석

#### 🔴 **Anomaly #1 (파란색) - 가장 심각**
```
패턴: Top 1: 27.8 → Top 2: 27.8 → Top 3~5: 20.0 (고르게 높음)
```

**의미**:
- 2개 센서가 **극도로 이상함** (Z-score 27.8)
- 나머지 3개도 매우 높음 (20.0)
- **심각한 다중 센서 이상** → 즉시 조치 필요

**실제 상황 추정**:
```
원인: 축계 전체 진동 급증
증상: 여러 방향 센서 동시 이상
조치: 즉시 운항 중지 및 정밀 점검
```

#### 🟠 **Anomaly #2 (주황색) - 중간 수준**
```
패턴: Top 1-2: 9.4 → Top 3-5: 7.5-7.7 (비교적 균등)
```

**의미**:
- 모든 센서가 **고르게 이상**
- 심각도는 #1보다 낮음
- **전반적인 진동 증가** → 모니터링 강화

**실제 상황 추정**:
```
원인: 축계 불균형 또는 마모
증상: 전방위 진동 증가
조치: 다음 입항 시 점검
```

#### 🟢 **Anomaly #3 (녹색) - 경미한 수준**
```
패턴: Top 1-2: 18.7 → Top 3-5: 13.8 (하락 패턴)
```

**의미**:
- 특정 센서가 주로 문제 (Top 1-2)
- 나머지는 연쇄 반응
- **국소적 이상** → 해당 센서 집중 점검

**실제 상황 추정**:
```
원인: 특정 베어링 이상
증상: 일부 센서 집중 이상
조치: 해당 부위 정밀 점검
```

### 💡 핵심 인사이트

#### 🎯 **이상 패턴 유형 분류**
```
Type A (Anomaly #1): 전체 급증형
- 모든 센서 동시 이상
- 즉시 대응 필요
- 위험도: ★★★★★

Type B (Anomaly #2): 전반 상승형
- 고르게 증가
- 모니터링 강화
- 위험도: ★★★☆☆

Type C (Anomaly #3): 국소 집중형
- 특정 센서 문제
- 해당 부위 점검
- 위험도: ★★★★☆
```

#### 🔧 **정비 우선순위**
```
1순위: Anomaly #1 유형 (Z-score > 25)
   → 즉시 운항 중지 및 점검

2순위: Anomaly #3 유형 (Top1-2만 높음)
   → 해당 센서 집중 점검

3순위: Anomaly #2 유형 (고르게 상승)
   → 정기 점검 시 확인
```

---

## 🎯 종합 분석 및 실무 활용

### 📋 **4개 그래프가 알려주는 것**

#### 1️⃣ **Anomaly Score Distribution**
```
✓ 모델 성능: 정상과 이상이 명확히 분리 (우수)
✓ 판단 기준: 점수 < -0.50 → 이상
✓ 신뢰도: 높음
```

#### 2️⃣ **Top 10 Important Features**
```
✓ 핵심 센서: 진동의 첨도, Peak-to-Peak, 왜도
✓ 모니터링 전략: 진동 통계량 집중 감시
✓ 센서 배치: 모든 방향 균등 모니터링
```

#### 3️⃣ **Normal vs Anomaly Distribution**
```
✓ 이상 비율: 5% (적정 수준)
✓ 관리 규모: 1일 50건 정도 검토 가능
✓ Threshold: 현재 설정 유지 권장
```

#### 4️⃣ **Top 3 Anomalies Profile**
```
✓ 이상 유형: 3가지 패턴 식별 가능
✓ 우선순위: Z-score 기반 분류
✓ 대응 전략: 유형별 차별화
```

---

## 🚀 실무 적용 시나리오

### 📱 **시나리오 1: 실시간 모니터링**

```python
if anomaly_score < -0.50:
    # 이상 감지!
    top_features = get_top_5_features()

    if top_features[0].z_score > 25:
        # Type A: 전체 급증형
        alert("긴급: 즉시 점검 필요", priority="HIGH")

    elif top_features[0].z_score > 15 and top_features[4].z_score < 10:
        # Type C: 국소 집중형
        alert(f"경고: {top_features[0].name} 센서 점검", priority="MEDIUM")

    else:
        # Type B: 전반 상승형
        alert("주의: 모니터링 강화", priority="LOW")
```

### 🔧 **시나리오 2: 정기 점검 계획**

```
월간 리포트 생성:
1. 이상 발생 빈도: 150건/월 (5%)
2. 주요 원인 센서: kurtosis 계열 (80%)
3. 정비 필요 부위: 베어링 #3, #7
4. 예방 정비 권고: 2주 내 교체
```

### 📊 **시나리오 3: 대시보드 설계**

```
┌─────────────────────────────────┐
│  실시간 이상 점수 그래프         │ ← Graph 1 활용
├─────────────────────────────────┤
│  핵심 모니터링 센서 Top 10      │ ← Graph 2 활용
│  (Kurtosis, P2P, Skewness)      │
├─────────────────────────────────┤
│  금일 이상 발생률: 4.8%         │ ← Graph 3 활용
├─────────────────────────────────┤
│  최근 이상 알림 (우선순위별)    │ ← Graph 4 활용
│  🔴 급증형: 2건                 │
│  🟡 국소형: 5건                 │
│  🟢 상승형: 8건                 │
└─────────────────────────────────┘
```

---

## 📈 비교: 다른 모델과의 차이점

### 🆚 **Isolation Forest vs Autoencoder vs LSTM**

| 측면 | Isolation Forest | Autoencoder | LSTM |
|------|------------------|-------------|------|
| **Feature Importance** | ✅ 명확 (Graph 2) | △ 간접적 | ❌ 어려움 |
| **해석 가능성** | ✅ Z-score (Graph 4) | △ 재구성 오차 | ❌ 복잡 |
| **이상 유형 분류** | ✅ 3가지 (Graph 4) | △ 가능 | ❌ 어려움 |
| **실무 활용성** | ✅ 최고 | △ 중간 | △ 중간 |

**결론**: Isolation Forest의 **시각화가 가장 실무 친화적**

---

## 💡 추가 분석 아이디어

### 1️⃣ **시간대별 이상 발생 패턴**
```python
# 시간대별로 Graph 3 분석
morning_anomaly_rate = 4.2%
afternoon_anomaly_rate = 5.8%  # 오후에 더 많이 발생

→ 인사이트: 오후 운항 시 더 주의 필요
```

### 2️⃣ **센서 조합 분석**
```python
# Graph 2의 Top 10 센서 조합으로 새 특징 생성
kurtosis_sum = sum(all_kurtosis_features)

→ 인사이트: 복합 지표로 더 정확한 탐지
```

### 3️⃣ **Threshold 최적화**
```python
# Graph 1에서 분리 지점 조정
current_threshold = -0.50
optimal_threshold = find_best_separation()

→ 인사이트: ROC Curve로 최적점 찾기
```

---

## ✅ 체크리스트: 시각화 활용

- [ ] Graph 1: 모델이 정상/이상을 잘 구분하는지 확인
- [ ] Graph 2: 핵심 모니터링 센서 10개 파악
- [ ] Graph 3: 이상 비율 5% 적정성 검토
- [ ] Graph 4: 이상 유형 3가지 대응 전략 수립
- [ ] 대시보드에 4개 그래프 통합
- [ ] 정비팀에 해석 가이드 전달
- [ ] 월간 리포트 자동화

---

## 🎓 결론

### 🌟 **이 시각화가 제공하는 가치**

1. **신뢰성**: 모델이 제대로 작동하는지 확인 (Graph 1)
2. **우선순위**: 어떤 센서를 집중 모니터링할지 결정 (Graph 2)
3. **규모 파악**: 관리 가능한 수준인지 판단 (Graph 3)
4. **대응 전략**: 이상 유형별 조치 방법 (Graph 4)

### 🚀 **다음 단계**

1. 이 분석을 **정비팀과 공유**
2. **대시보드에 통합**
3. **알림 시스템 구축** (Graph 4 패턴 기반)
4. **월간 리포트 자동화**

---

**작성일**: 2025-11-05
**파일**: isolation_forest_detailed_analysis.png
**MLflow UI**: http://localhost:5000
