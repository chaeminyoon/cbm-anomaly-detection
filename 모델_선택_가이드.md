# 🎯 CBM 이상 탐지 모델 선택 가이드

## 📊 학습 완료된 모델 (3개)

MLflow UI (`http://localhost:5000`)에서 확인한 결과를 바탕으로 모델을 비교합니다.

---

## 1️⃣ 모델 성능 비교표

| 순위 | 모델 | Test 이상률 | 장점 | 단점 | 학습 시간 |
|------|------|------------|------|------|----------|
| 🥈 | **Isolation Forest** | ~5.03% | • 빠른 학습/추론<br>• 설명 가능성 높음<br>• Feature Importance 제공 | • 시계열 패턴 미반영<br>• 복잡한 패턴 놓칠 수 있음 | 2-5분 ⚡ |
| 🥇 | **Autoencoder** | ~5.21% | • 비선형 패턴 학습<br>• 재구성 오차로 해석 용이<br>• 균형잡힌 성능 | • 학습 시간 필요<br>• 하이퍼파라미터 조정 필요 | 5-10분 |
| 🥉 | **LSTM Autoencoder** | ~5.6%+ | • 시계열 패턴 반영<br>• 시간적 의존성 학습<br>• 미래 예측 가능 | • 가장 느린 학습<br>• 메모리 많이 사용<br>• 과적합 위험 | 10-20분 🐌 |

*실제 수치는 MLflow UI에서 확인하세요*

---

## 2️⃣ 모델별 상세 분석

### 🌲 Isolation Forest (추천도: ⭐⭐⭐⭐⭐)

#### 언제 사용하면 좋은가?
✅ **실시간 모니터링**이 필요한 경우
- 빠른 추론 속도 (ms 단위)
- 즉각적인 이상 감지 필요

✅ **설명 가능성**이 중요한 경우
- Feature Importance로 어떤 센서가 문제인지 파악
- 정비팀에게 명확한 근거 제시

✅ **안정적인 운영**이 우선인 경우
- 학습 없이도 바로 사용 가능
- 적은 데이터로도 작동

#### 실무 적용 예시
```
이상 감지 → Feature Importance 확인 → "RPM과 온도 센서 이상"
→ 해당 센서 집중 모니터링 → 정비팀 즉시 조치
```

#### 단점
❌ 시계열 패턴을 고려하지 않음 (과거 이력 무시)
❌ 복잡한 센서 간 상호작용 놓칠 수 있음

---

### 🧠 Autoencoder (추천도: ⭐⭐⭐⭐)

#### 언제 사용하면 좋은가?
✅ **복잡한 센서 상호작용** 패턴 감지
- 여러 센서가 동시에 이상 → 감지 우수
- 비선형 관계 학습

✅ **균형잡힌 성능**이 필요한 경우
- 속도와 정확도의 중간
- 범용적인 활용

✅ **재구성 오차로 해석**하고 싶은 경우
- 어떤 특징이 얼마나 이상한지 정량화
- 시각화가 직관적

#### 실무 적용 예시
```
정상 패턴 학습 → 새 데이터 재구성 → 오차 큰 부분 발견
→ "축 진동 패턴이 비정상" → 정밀 진단
```

#### 단점
❌ 하이퍼파라미터 튜닝 필요 (encoding_dim, epochs 등)
❌ 시계열 순서 고려 안 함

---

### ⏰ LSTM Autoencoder (추천도: ⭐⭐⭐)

#### 언제 사용하면 좋은가?
✅ **시계열 패턴**이 중요한 경우
- 점진적인 열화(degradation) 감지
- 주기적인 이상 패턴

✅ **미래 예측**이 필요한 경우
- 다음 시점의 이상 가능성 예측
- 예방 정비 시기 결정

✅ **정밀한 분석**이 가능한 경우
- 충분한 컴퓨팅 자원
- 학습 시간 여유

#### 실무 적용 예시
```
과거 10개 시점 분석 → "진동이 점점 증가하는 패턴" 감지
→ 2일 후 고장 예측 → 사전 정비
```

#### 단점
❌ 학습/추론 속도가 가장 느림
❌ 메모리 많이 사용 (시퀀스 데이터)
❌ 과적합 위험 (작은 데이터셋에서)

---

## 3️⃣ 상황별 추천 모델

### 🎯 시나리오 1: 실시간 모니터링 시스템 구축
**목표**: 선박 운항 중 실시간으로 이상 감지

**추천**: **Isolation Forest** 🥇
- 이유: 빠른 추론 속도 (< 1ms)
- 설정: contamination=0.05 (5% 이상률)
- 장점: Feature Importance로 즉시 원인 파악

**대안**: Autoencoder (재구성 오차로 더 정밀한 분석 가능)

---

### 🎯 시나리오 2: 정기 점검 시 정밀 분석
**목표**: 월 1회 축적된 데이터 분석으로 이상 패턴 찾기

**추천**: **Autoencoder + LSTM Autoencoder 병용** 🥇
- Autoencoder: 전반적인 이상 스크리닝
- LSTM: 시간적 트렌드 분석
- 장점: 정밀한 진단 가능

---

### 🎯 시나리오 3: 예방 정비 계획 수립
**목표**: 고장 전조증상 미리 파악

**추천**: **LSTM Autoencoder** 🥇
- 이유: 시계열 패턴 학습으로 열화 예측
- 설정: sequence_length=10 (과거 10 시점)
- 활용: 정비 일정 최적화

**보조**: Isolation Forest (즉각 대응용)

---

### 🎯 시나리오 4: 제한된 컴퓨팅 환경 (엣지 디바이스)
**목표**: 선박 내 소형 서버에서 실행

**추천**: **Isolation Forest** 🥇
- 이유: 메모리/CPU 효율적
- 크기: 모델 파일 < 10MB
- 추론: CPU만으로 빠르게 실행

---

## 4️⃣ 종합 추천

### 🏆 최종 권장사항

#### **단일 모델 선택 시**
```
1순위: Isolation Forest
- 속도, 설명 가능성, 안정성 우수
- 실무 적용 가장 용이
- Test 이상률 5.03% (최우수)
```

#### **앙상블 시스템 구축 시** (권장 ⭐⭐⭐⭐⭐)
```
Level 1 (실시간): Isolation Forest
   ↓ 이상 감지 시
Level 2 (정밀 분석): Autoencoder
   ↓ 심각한 이상 시
Level 3 (트렌드 분석): LSTM Autoencoder
```

**장점**:
- 빠른 1차 스크리닝 (Isolation Forest)
- 정밀한 2차 검증 (Autoencoder)
- 미래 예측 (LSTM)

---

## 5️⃣ 실제 배포 체크리스트

### Isolation Forest 배포 시
- [ ] MLflow에서 모델 로드
```python
import mlflow.sklearn
model = mlflow.sklearn.load_model('runs:/c66eb2b2.../model')
```
- [ ] Threshold 설정 (5% 이상률 기준)
- [ ] Feature Importance 시각화 대시보드 구축
- [ ] 알람 시스템 연동

### Autoencoder 배포 시
- [ ] MLflow에서 모델 로드
```python
import mlflow.keras
model = mlflow.keras.load_model('runs:/0b4e1bbb.../model')
threshold = np.load('autoencoder_threshold.npy')
```
- [ ] 재구성 오차 임계값 설정
- [ ] 배치 추론 파이프라인 구축

### LSTM Autoencoder 배포 시
- [ ] 시퀀스 데이터 전처리 파이프라인
- [ ] 슬라이딩 윈도우 구현
- [ ] 메모리 관리 최적화

---

## 6️⃣ 성능 개선 방안

### 현재 결과 분석
- 3개 모델 모두 Test 이상률 **5% 내외** → 비슷한 성능
- Isolation Forest가 **가장 빠르면서 최고 성능**

### 개선 가능성

#### Isolation Forest
- `n_estimators` 증가 (100 → 200)
- `max_samples` 조정
- Feature Engineering (새로운 파생 변수)

#### Autoencoder
- `encoding_dim` 최적화 (32 → 16 or 64)
- Dropout 추가 (과적합 방지)
- Learning rate scheduling

#### LSTM Autoencoder
- `sequence_length` 조정 (10 → 20)
- Bidirectional LSTM 사용
- Attention mechanism 추가

---

## 7️⃣ 비용-효과 분석

| 모델 | 학습 비용 | 운영 비용 | 효과 | ROI |
|------|----------|----------|------|-----|
| Isolation Forest | ⭐ 낮음 | ⭐ 낮음 | ⭐⭐⭐⭐ | 🥇 최고 |
| Autoencoder | ⭐⭐ 중간 | ⭐⭐ 중간 | ⭐⭐⭐⭐ | 🥈 우수 |
| LSTM Autoencoder | ⭐⭐⭐ 높음 | ⭐⭐⭐ 높음 | ⭐⭐⭐ | 🥉 양호 |

---

## 8️⃣ 결론 및 실행 계획

### 🎯 최종 결론

**당장 시작한다면**: **Isolation Forest**
- 이유: 빠르고, 정확하고, 설명 가능
- 적용: 실시간 모니터링에 즉시 투입

**장기적으로**: **Isolation Forest + Autoencoder 앙상블**
- Isolation Forest: 1차 스크리닝
- Autoencoder: 정밀 검증
- 필요 시 LSTM 추가

---

### 📋 실행 단계

#### Phase 1 (1주): Isolation Forest 배포
```bash
1. MLflow에서 모델 로드
2. API 서버 구축
3. 모니터링 대시보드 연결
4. 알람 시스템 테스트
```

#### Phase 2 (2주): Autoencoder 추가
```bash
1. Isolation Forest 이상 감지 시 Autoencoder로 검증
2. 재구성 오차 시각화
3. 정밀도 향상 확인
```

#### Phase 3 (4주): LSTM 평가 및 선택적 도입
```bash
1. 시계열 패턴 중요성 평가
2. 필요 시 예방 정비 모듈에 LSTM 추가
3. 성능 모니터링
```

---

## 💡 추가 고려사항

### 데이터 품질
- 센서 노이즈 → 전처리 강화
- 결측치 → Imputation 전략
- 불균형 → SMOTE 등 적용

### 도메인 지식 활용
- 선박 운영 전문가와 협업
- Feature Engineering (RPM/온도 비율 등)
- Threshold 조정 (false alarm 최소화)

### 지속적 개선
- A/B 테스트로 모델 비교
- 실제 고장 사례 피드백
- 모델 재학습 주기 설정 (월 1회 권장)

---

## 📞 문의 및 다음 단계

질문이 있으시면:
1. MLflow UI에서 각 모델의 Artifacts (PNG) 확인
2. 성능 지표 상세 비교
3. 실제 데이터로 추가 검증

**다음 단계**: 선택한 모델로 프로토타입 API 구축

---

**작성일**: 2025-11-05
**MLflow UI**: http://localhost:5000
**모델 저장 위치**: D:\Downloads\mlruns\
